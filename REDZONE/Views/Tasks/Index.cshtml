@model REDZONE.Models.RZTasksViewModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string apTaskDisplay = "";
    string mtrcTaskDisplay = "";
    string apTaskGlyph = "glyphicon-chevron-right";
    string mtrcTaskGlyph = "glyphicon-chevron-right";

    if (ViewBag.display == "ap")
    {
        apTaskDisplay = "in";
        apTaskGlyph = "glyphicon-chevron-down";
    }
    else if(ViewBag.display == "mtrc")
    {
        mtrcTaskDisplay = "in";
        mtrcTaskGlyph = "glyphicon-chevron-down";
    }
}

<style>
    .overdue {
        color:red;
        font-weight:bold;
    }
</style>
<script src="~/Scripts/Tasks_index.js"></script>

<div class="panel panel-default" style="font-family:Arial; max-width:1000px; margin:0 auto; margin-top:5px">
    <div class="panel-heading padding2">
        <h2>Tasks</h2>
        <input type="hidden" id="hdnDisplay" value="@ViewBag.display"/>
    </div>

    <div class="panel-body padding2 ">
        @*****************@
        @*SUBMITTER TASKS*@
        @*****************@
        <div class="row" id="divSubmitterTasks" style="margin-left:5px; margin-right:5px">
            @if (Model.apSubmitTaskList.Count() > 0)
            {
                <div class="btn-toolbar" style="margin-top:5px">
                    <div class="bordered" style="display:table-cell; border-top-left-radius:4px; border-bottom-left-radius:4px; border-color: transparent; border-right:transparent; ">
                        <button type="button" class="btn btn-default btn-group" style="margin-left:0px; border-color:transparent; border-top-right-radius:0px; border-bottom-right-radius:0px">
                            <span class="glyphicon @apTaskGlyph"></span>
                        </button>
                    </div>
                    <div class="bordered" style="display:table-cell; width:100%; vertical-align:middle; border-color:transparent; border-bottom-color:lightgray">
                        <h4 class="btn-group" style="text-align:left; margin:auto; margin-left:10px ">Action Plan Tasks</h4>
                    </div>
                </div>

                <div class="collapse @apTaskDisplay" style="margin-left:42px">
                    @foreach (var bldg in Model.apSubmitTaskList)
                    {
                        <div class="btn-toolbar" style="margin-top:5px">
                            <div class="bordered" style="display:table-cell; border-top-left-radius:4px; border-bottom-left-radius:4px; border-color:transparent; border-right:transparent">
                                <button type="button" class="btn btn-default btn-group" style="margin-left:0px; border-color:transparent; border-top-right-radius:0px; border-bottom-right-radius:0px">
                                    <span class="glyphicon glyphicon-chevron-right"></span>
                                </button>
                            </div>
                            <div class="bordered" style="display:table-cell; width:100%; vertical-align:middle; border-color:transparent; border-bottom-color:lightgray">
                                <h4 class="btn-group" style="text-align:left; margin:auto; margin-left:10px ">@bldg.bldgName</h4>
                            </div>
                        </div>

                        <div class="collapse" style="margin-left:42px">
                            @foreach (var period in bldg.periodList)
                            {
                                <div class="btn-toolbar" style="margin-top:5px">
                                    <div class="bordered" style="display:table-cell; border-top-left-radius:4px; border-bottom-left-radius:4px; border-color:transparent; border-right:transparent">
                                        <button type="button" class="btn btn-default btn-group" style="margin-left:0px; border-color:transparent; border-top-right-radius:0px; border-bottom-right-radius:0px">
                                            <span class="glyphicon glyphicon-chevron-right"></span>
                                        </button>
                                    </div>
                                    <div class="bordered" style="display:table-cell; width:100%; vertical-align:middle; border-color:transparent; border-bottom-color:lightgray">
                                        <h5 class="btn-group" style="text-align:left; margin:auto; margin-left:10px ">@period.periodName</h5>
                                    </div>
                                </div>

                                <div class="collapse" style="margin-left:40px">
                                    <table class="table table-condensed table-hover" id="tblAPTasks" style="margin-top:5px">
                                        <tr style="background-color:lightgray">
                                            <th style="text-align:center; width:25%">
                                                @Html.DisplayNameFor(model => model.apSubmitTaskList.First().periodList.First().mtrcList.First().mtrc_prod_display_text)
                                            </th>
                                            <th style="text-align:center; width:25%">
                                                @Html.DisplayNameFor(model => model.apSubmitTaskList.First().periodList.First().mtrcList.First().status)
                                            </th>
                                            <th style="text-align:center; width:25%">
                                                Action
                                            </th>
                                            <th style="text-align:center; width:25%">
                                                Due By
                                            </th>
                                        </tr>

                                        @foreach (var mtrc in period.mtrcList)
                                        {
                                            <tr>
                                                <td style="text-align:center; width:25%">
                                                    @Html.DisplayFor(modelItem => mtrc.mtrc_prod_display_text)
                                                </td>
                                                <td style="text-align:center; width:25%">
                                                    @Html.DisplayFor(modelItem => mtrc.status)
                                                </td>
                                                <td style="text-align:center; width:25%">
                                                    @{string apUrl = "/ActionPlan/viewEdit/?mp_id=" + mtrc.mtrc_period_id + "&bldg_id=" + mtrc.bldg_id + "&bapm_id=" + mtrc.rz_bapm_id;}
                                                    <a href="@apUrl">@mtrc.action</a>
                                                </td>
                                                <td style="text-align:center; width:25%">
                                                    TBD
                                                </td>
                                            </tr>
                                        }
                                    </table>

                                </div>
                            }


                        </div>
                    }
                </div>
            }
        </div>
        @****************@
        @*REVIEWER TASKS*@
        @****************@
        <div class="row" id="divReviewerTasks" style="margin-left:5px; margin-right:5px">
            @if (Model.apReviewTaskList.Count() > 0)
            {
                <div class="btn-toolbar" style="margin-top:5px">
                    <div class="bordered" style="display:table-cell; border-top-left-radius:4px; border-bottom-left-radius:4px; border-color: transparent; border-right:transparent; ">
                        <button type="button" class="btn btn-default btn-group" style="margin-left:0px; border-color:transparent; border-top-right-radius:0px; border-bottom-right-radius:0px">
                            <span class="glyphicon @apTaskGlyph"></span>
                        </button>
                    </div>
                    <div class="bordered" style="display:table-cell; width:100%; vertical-align:middle; border-color:transparent; border-bottom-color:lightgray">
                        <h4 class="btn-group" style="text-align:left; margin:auto; margin-left:10px ">Action Plan Review Tasks</h4>
                    </div>
                </div>

                <div class="collapse @apTaskDisplay" style="margin-left:42px;">
                    @foreach (var mtrc in Model.apReviewTaskList)
                    {
                        <div class="btn-toolbar" style="margin-top:5px">
                            <div class="bordered" style="display:table-cell; border-top-left-radius:4px; border-bottom-left-radius:4px; border-color:transparent; border-right:transparent">
                                <button type="button" class="btn btn-default btn-group" style="margin-left:0px; border-color:transparent; border-top-right-radius:0px; border-bottom-right-radius:0px">
                                    <span class="glyphicon glyphicon-chevron-right"></span>
                                </button>
                            </div>
                            <div class="bordered" style="display:table-cell; width:100%; vertical-align:middle; border-color:transparent; border-bottom-color:lightgray">
                                <h4 class="btn-group" style="text-align:left; margin:auto; margin-left:10px ">@mtrc.mtrc_prod_display_text</h4>
                            </div>
                        </div>

                        <div class="collapse" style="margin-left:42px">
                            @foreach (var period in mtrc.periodList)
                            {
                                <div class="btn-toolbar" style="margin-top:5px">
                                    <div class="bordered" style="display:table-cell; border-top-left-radius:4px; border-bottom-left-radius:4px; border-color:transparent; border-right:transparent">
                                        <button type="button" class="btn btn-default btn-group" style="margin-left:0px; border-color:transparent; border-top-right-radius:0px; border-bottom-right-radius:0px">
                                            <span class="glyphicon glyphicon-chevron-right"></span>
                                        </button>
                                    </div>
                                    <div class="bordered" style="display:table-cell; width:100%; vertical-align:middle; border-color:transparent; border-bottom-color:lightgray">
                                        <h5 class="btn-group" style="text-align:left; margin:auto; margin-left:10px ">@period.periodName</h5>
                                    </div>
                                </div>

                                <div class="collapse" style="margin-left:40px">
                                    <table class="table table-condensed table-hover" id="tblAPTasks" style="margin-top:5px">
                                        <tr style="background-color:lightgray">
                                            <th style="text-align:center; width:25%">
                                                @Html.DisplayNameFor(model => model.apReviewTaskList.First().periodList.First().bldgList.First().bldgName)
                                            </th>
                                            <th style="text-align:center; width:25%">
                                                @Html.DisplayNameFor(model => model.apReviewTaskList.First().periodList.First().bldgList.First().status)
                                            </th>
                                            <th style="text-align:center; width:25%">
                                                Action
                                            </th>
                                            <th style="text-align:center; width:25%">
                                                Due By
                                            </th>
                                        </tr>

                                        @foreach (var bldg in period.bldgList)
                                        {
                                            string overdueClass = (new DateTime(Int32.Parse(bldg.year), Int32.Parse(bldg.month), 18) < DateTime.Today) ? "overdue" : "";
                                            <tr>
                                                <td style="text-align:center; width:25%">
                                                    @Html.DisplayFor(modelItem => bldg.bldgName)
                                                </td>
                                                <td style="text-align:center; width:25%">
                                                    @Html.DisplayFor(modelItem => bldg.status)
                                                </td>
                                                <td style="text-align:center; width:25%">
                                                    @{string apUrl = "/ActionPlan/viewEdit/?mp_id=" + bldg.mtrc_period_id + "&bldg_id=" + bldg.bldg_id + "&bapm_id=" + bldg.rz_bapm_id;}
                                                    <a href="@apUrl">@bldg.action</a>
                                                </td>
                                                <td class="@overdueClass" style="text-align:center; width:25%">
                                                    @bldg.month/18/@bldg.year
                                                </td>
                                            </tr>
                                        }
                                    </table>

                                </div>
                            }
                        </div>
                    }
                </div>
            }
        </div>
        @************************@
        @*METRIC COLLECTOR TASKS*@
        @************************@
        <div class="row" id="divCollectorTasks" style="margin-left:5px; margin-right:5px">
            @if (Model.mtrcTaskList.Count() > 0)
            {
                <div class="btn-toolbar" style="margin-top:5px">
                    <div class="bordered" style="display:table-cell; border-top-left-radius:4px; border-bottom-left-radius:4px; border-color: transparent; border-right:transparent; ">
                        <button type="button" class="btn btn-default btn-group" style="margin-left:0px; border-color:transparent; border-top-right-radius:0px; border-bottom-right-radius:0px">
                            <span class="glyphicon @mtrcTaskGlyph"></span>
                        </button>
                    </div>
                    <div class="bordered" style="display:table-cell; width:100%; vertical-align:middle; border-color:transparent; border-bottom-color:lightgray">
                        <h4 class="btn-group" style="text-align:left; margin:auto; margin-left:10px ">Action Plan Review Tasks</h4>
                    </div>
                </div>

                <div class="collapse @mtrcTaskDisplay" style="margin-left:42px">
                    @foreach (var period in Model.mtrcTaskList)
                    {
                        <div class="btn-toolbar" style="margin-top:5px">
                            <div class="bordered" style="display:table-cell; border-top-left-radius:4px; border-bottom-left-radius:4px; border-color:transparent; border-right:transparent">
                                <button type="button" class="btn btn-default btn-group" style="margin-left:0px; border-color:transparent; border-top-right-radius:0px; border-bottom-right-radius:0px">
                                    <span class="glyphicon glyphicon-chevron-right"></span>
                                </button>
                            </div>
                            <div class="bordered" style="display:table-cell; width:100%; vertical-align:middle; border-color:transparent; border-bottom-color:lightgray">
                                <h5 class="btn-group" style="text-align:left; margin:auto; margin-left:10px ">@period.periodName</h5>
                            </div>
                        </div>

                        <div class="collapse" style="margin-left:42px">
                            <table class="table table-condensed table-hover" id="tblAPTasks" style="margin-top:5px">
                                <tr style="background-color:lightgray">
                                    <th style="text-align:center; width:25%">
                                        @Html.DisplayNameFor(model => model.mtrcTaskList.First().mtrcList.First().mtrc_prod_display_text)
                                    </th>
                                    <th style="text-align:center; width:25%">
                                        @Html.DisplayNameFor(model => model.mtrcTaskList.First().mtrcList.First().status)
                                    </th>
                                    <th style="text-align:center; width:25%">
                                        Action
                                    </th>
                                    <th style="text-align:center; width:25%">
                                        Due By
                                    </th>
                                </tr>

                                @foreach (var mtrc in period.mtrcList)
                                {
                                    string overdueClass = (new DateTime(Int32.Parse(mtrc.year), Int32.Parse(mtrc.month), 18) < DateTime.Today) ? "overdue" : "";
                                    <tr>
                                        <td style="text-align:center; width:25%">
                                            @Html.DisplayFor(modelItem => mtrc.mtrc_prod_display_text)
                                        </td>
                                        <td style="text-align:center; width:25%">
                                            @Html.DisplayFor(modelItem => mtrc.status)
                                        </td>
                                        <td style="text-align:center; width:25%">
                                            @{string mtrcUrl = "/Metric/EditView/" + mtrc.mtrc_id + "?month=" + mtrc.month_name + "&year=" + mtrc.year;}
                                            <a href="@mtrcUrl">Manage Metric</a>
                                        </td>
                                        <td class="@overdueClass" style="text-align:center; width:25%">
                                            @mtrc.month/18/@mtrc.year
                                        </td>
                                    </tr>
                                }
                            </table>

                        </div>
                    }
                </div>
            }

        </div>
    </div>
</div>

<!-- Quick Review Modal -->
<div id="quickReviewForm" class="modal fade" role="dialog">
    <div class="modal-dialog" style="width:80%">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" id="quickReviewHeader">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Quick Action Plan Review</h4>
            </div>
            <div class="modal-body" id="quickReviewBody">

            </div>
            <div class="modal-footer" id="quickReviewFooter">
                <input type="button" disabled class="btn btn-primary" id="btnApproveActionPlan" value="Add" />
                <input type="button" disabled class="btn btn-primary" id="btnRejectActionPlan" value="Add" />
                <button type="button" class="btn btn-warning" id="btnCancelReview" data-dismiss="modal">Cancel</button>
            </div>
        </div>

    </div>
</div>
