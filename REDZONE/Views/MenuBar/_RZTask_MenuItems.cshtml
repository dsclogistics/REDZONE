@model REDZONE.Models.RZTaskCounts

<style>
    /* Define how each icon button should look like */
    .taskButton {
        color: white;
        display: inline-block; /* Inline elements with width and height. TL;DR they make the icon buttons stack from left-to-right instead of top-to-bottom */
        position: relative; /* All 'absolute'ly positioned elements are relative to this one */
        padding: 2px 5px; /* Add some padding so it looks nice */
    }

    /* Make the badge float in the top right corner of the button */
    .button__badge {
        background-color: #fa3e3e;
        border-radius: 5px;
        color: white;
        padding: 0px 5px;
        font-size: 11px;
        position: absolute; /* Position the badge within the relatively positioned button */
        top: 4px;
        right: -4px;
    }

    .ddTask {
    position: relative;
    display: inline-block;
}

.ddTask-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    /*padding: 12px 16px;*/
    padding:1px;
}

.ddTask:hover .ddTask-content {
    display: block;
}
</style>
<ul class="nav navbar-nav menuItem " id="myTasks" style="padding:0; font-family:Arial; margin-left:10px ">
    <li class="dropdown ddTask" style="padding:0; ">
        <a class="dropdown-toggle taskButton" data-toggle="dropdown" href="#">
            <span><i class="glyphicon glyphicon-flag"></i></span>
            @if (Model.totalTasks > 0)
            {
                <span class="button__badge">@Model.totalTasks</span>
            }
            @*<span class="badge">My Tasks</span>
                <span class="badge" style="color:blue">@Model.totalTasks</span>
                <span class="glyphicon glyphicon-flag" style="color:green"></span>*@
        </a>
        <ul class="dropdown-menu">
            @if (Model.totalTasks > 0)
            {
                if (Model.mtrcCount > 0)
                {
                    <li><a href="/Tasks/Index/?display=mtrc">Metric Tasks (@Model.mtrcCount)</a></li>
                }

                if (Model.actPlanCount > 0)
                {
                    <li><a href="/Tasks/Index/?display=ap">Action Plan Tasks (@Model.actPlanCount)</a></li>
                }
            }
            else
            {
                <li>NO PENDING TASKS</li>
            }
        </ul>
        <div class="ddTask-content">
            <div style="background-color:black; color:white">PENDING TASKS</div>
            <div id="taskSummary" style="border:3px solid black; border-bottom-left-radius:4px; border-bottom-right-radius:4px; ">
            </div>
        </div>
    </li>
</ul>

<script>
    $(document).ready(function () {
        //Hide or Display the "My Tasks" Menu Items according to the User Task Status
        //alert("User is in role RZ_AP_SUBMITTER is @@User.IsInRole("RZ_AP_SUBMITTER")");
        if ("@User.IsInRole("RZ_AP_REVIEWER")" == "True" || "@User.IsInRole("RZ_AP_SUBMITTER")" == "True" || "@User.IsInRole("MTRC_COLLECTOR")" == "True") {
            if ("@Model.totalTasks" == "0") {
                $('#mMyTasks').hide();
                $('#myTasks').hide();
            }
            else {
                $('#mMyTasks').show();
                $('#myTasks').show();
                if ("@Model.mtrcCount" == "0") { $('#menuTaskMetric').hide(); }
                else { $('#menuTaskMetric').show(); }
                if ("@Model.actPlanCount" == "0") { $('#menuTaskAP').hide(); }
                else { $('#menuTaskAP').show(); }
                //alert("You have alerts");
            }
        }
        else {
            $('#mMyTasks').hide();
            $('#myTasks').hide();
            //alert("You can't access alerts.");
        }

        $('.ddTask').mouseenter(function () {
            //When Task Icon is mouseovered, display a "wait" Message then call ajax to update again with the Server retrieved data
            $('#taskSummary').html('<br /><br />PLEASE WAIT WHILE DATA LOADS<br /><br /><img src="/Images/ui-anim_basic_16x16.gif" /><br /><br />');
            //alert('Loading data via ajax');
            var cashData = false;
            //if ($('#cacheTasksList').val() == "Y") {cashData = true; }
            //else {
            //    $('#cacheTasksList').val("Y");
            //    cashData = false;
            //}

            $.ajax({
                url: '/Tasks/_myTaskSummary',
                method: "POST",
                cache: cashData,
                dataType: "text",
                //data: { uFName: pFName, uLName: pLName, uLoginName: pLoginName, email: pEmail, uRole: pRole, uBuildings: pBuildings, uId: pId, turnOff: pTurnOff },
                error: function (jqXHR, textStatus, errorThrown) {
                    $('#taskSummary').html("ERROR: Failed to load data from server");
                }
            }).done(function (taskList) {
                $('#taskSummary').html(taskList);
            });

        });

        $('.ddTask').click(function () {
            $('#cacheTasksList').val("N");
        });

    });
</script>
